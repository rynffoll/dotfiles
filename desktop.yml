- hosts: all
  vars:
    desktop_packages:
      - mozilla-fira-mono-fonts
      - gimp
      - google-chrome-stable
      - gnome-tweak-tool
      - gnome-shell-extension-user-theme
      - chrome-gnome-shell
      - gnome-multi-writer
      - mpv
      - gnome-mpv
      - dropbox
      - nautilus-dropbox
      - gnome-terminal-nautilus
      - gnome-sound-recorder
      - dconf-editor
      - transmission
      - remmina
      - keepassxc
      - firewall-config
      - skypeforlinux
      - telegram-desktop
      - kdeconnectd
    gnome_extentions:
      - name: "window-navigator"
        branch: "master"
        url: "https://github.com/rynffoll/window-navigator"
  tasks:
    - name: Install desktop packages
      become: yes
      package: name="{{ item }}" state=latest
      with_items: "{{ desktop_packages }}"
      tags:
        - packages

    - name: Install gnome extentions
      git:
        repo: "{{ item.url }}"
        version: "{{ item.branch }}"
        dest: "~/.local/share/gnome-shell/extensions"
      with_items: "{{ gnome_extentions }}"
      tags:
        - desktop

    - name: Configure keyboard layouts
      shell: dconf write "/org/gnome/desktop/input-sources/sources" "[('xkb', 'us'), ('xkb', 'ru')]"
      tags:
        - desktop
        - kbd

    - name: Configure keyboard options
      shell: dconf write "/org/gnome/desktop/input-sources/xkb-options" "['ctrl:nocaps']"
      tags:
        - desktop
        - kbd

    # since ansible 2.4
    # - name: Configure keyboard layouts
    #   dconf:
    #     key: "/org/gnome/desktop/input-sources/sources"
    #     value: "[('xkb', 'us'), ('xkb', 'ru')]"
    #     state: present
    #   tags:
    #       - desktop
    #       - kbd

    # - name: Configure keyboard options
    #   dconf:
    #     key: "/org/gnome/desktop/input-sources/xkb-options"
    #     value: "['ctrl:nocaps']"
    #     state: present
    #   tags:
    #       - desktop
    #       - kbd
