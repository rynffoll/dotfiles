- hosts: all
  vars:
    desktop_packages:
      - mozilla-fira-mono-fonts
      - gimp
      - google-chrome-stable
      - gnome-tweak-tool
      - gnome-shell-extension-user-theme
      - chrome-gnome-shell
      - gnome-multi-writer
      - mpv
      - gnome-mpv
      - dropbox
      - nautilus-dropbox
      - gnome-terminal-nautilus
      - gnome-sound-recorder
      - dconf-editor
      - transmission
      - remmina
      - keepassxc
      - firewall-config
      - skypeforlinux
      - telegram-desktop
    gnome_extentions:
      - name: "window-navigator"
        branch: "master"
        url: "https://github.com/rynffoll/window-navigator"
    kbd_options:
      - { key: "/org/gnome/desktop/input-sources/sources", value: "[('xkb', 'us'), ('xkb', 'ru')]" }
      - { key: "/org/gnome/desktop/input-sources/xkb-options", value: "['ctrl:nocaps']" }
      - { key: "/org/gnome/desktop/input-sources/per-window", value: "true" }
    term_options:
      - { key: "/org/gnome/terminal/legacy/default-show-menubar", value: "false" }
      - { key: "/org/gnome/terminal/legacy/menu-accelerator-enabled", value: "false"}
    ui_options:
      - { key: "/org/gnome/desktop/interface/show-battery-percentage", value: "true" }
      - { key: "/org/gnome/desktop/interface/clock-show-date", value: "true" }
      - { key: "/org/gnome/desktop/wm/preferences/titlebar-font", value: "'Cantarell Bold 11'" }
      - { key: "/org/gnome/desktop/interface/font-name", value: "'Cantarell 11'" }
      - { key: "/org/gnome/desktop/interface/document-font-name", value: "'Sans 11'" }
      - { key: "/org/gnome/desktop/interface/monospace-font-name", value: "'Fira Mono Medium 11'" }
      - { key: "/org/gnome/settings-daemon/plugins/xsettings/hinting", value: "'slight'" }
      - { key: "/org/gnome/settings-daemon/plugins/xsettings/antialiasing", value: "'greyscale'" }
      - { key: "/org/gnome/desktop/wm/preferences/auto-raise", value: "true" }
      - { key: "/org/gnome/desktop/wm/preferences/mouse-button-modifier", value: "'<Alt>'" }
      - { key: "/org/gnome/desktop/wm/preferences/resize-with-right-button", value: "true" }
      - { key: "/org/gnome/settings-daemon/plugins/color/night-light-enabled", value: "true" }
      - { key: "/org/gnome/settings-daemon/plugins/color/night-light-temperature", value: "uint32 5000" }
      - { key: "/org/gnome/desktop/sound/event-sounds", value: "false" }
    exts_options:
      - { key: "/org/gnome/shell/window-switcher/current-workspace-only", value: "false" }
    favorite_apps: "['google-chrome.desktop', 'org.gnome.Terminal.desktop', 'emacsclient.desktop', 'jetbrains-idea-ce.desktop']"
  tasks:
    - name: Install desktop packages
      become: yes
      package: name="{{ item }}" state=present
      with_items: "{{ desktop_packages }}"
      tags:
        - packages

    - name: Configure dropbox
      shell: dropbox start -i &
      tags:
        - dropbox

    # - name: Install gnome extentions
    #   git:
    #     repo: "{{ item.url }}"
    #     version: "{{ item.branch }}"
    #     dest: "~/.local/share/gnome-shell/extensions"
    #     accept_hostkey: yes
    #   with_items: "{{ gnome_extentions }}"

    # TODO: rewrite to use dconf module, which will be able to available since ansible 2.4
    - name: Configure keyboard
      shell: dconf write "{{ item.key }}" "{{ item.value }}"
      with_items: "{{ kbd_options }}"
      tags:
        - kbd

    - name: Configure terminal
      shell: dconf write "{{ item.key }}" "{{ item.value }}"
      with_items: "{{ term_options }}"
      tags:
        - term

    - name: Configure UI
      shell: dconf write "{{ item.key }}" "{{ item.value }}"
      with_items: "{{ ui_options }}"
      tags:
        - ui

    - name: Configure favorite apps
      shell: dconf write "/org/gnome/shell/favorite-apps" "{{ favorite_apps }}"
      tags:
        - ui

    - name: Configure extentions
      shell: dconf write "{{ item.key }}" "{{ item.value }}"
      with_items: "{{ exts_options }}"
      tags:
        - exts

    - name: Load extentions configuration
      shell: dconf load /org/gnome/shell/extensions/ < "{{ playbook_dir }}/files/extensions.dconf"
      tags:
        - exts
